# Technology Stack

[← Back to Architecture Index](./README.md) | [← Previous: Project Initialization](./02-project-initialization.md) | [Next: Project Structure →](./04-project-structure.md)

---

## Decision Summary

| Category | Decision | Version/Details | Affects | Rationale |
|----------|----------|----------------|---------|-----------|
| **Frontend Framework** | Next.js | 15.x with App Router | All UI features | React Server Components, built-in optimization, excellent DX |
| **Frontend Language** | TypeScript | 5.x | All frontend code | Type safety, better tooling, catches errors early |
| **Frontend Styling** | Tailwind CSS + shadcn/ui | 3.x / latest | All UI components | Rapid development, mobile-responsive, professional components |
| **Backend Framework** | FastAPI | 0.115+ | All API endpoints | Async support, automatic docs, WebSocket support, excellent performance |
| **Backend Language** | Python | 3.11+ | All backend code | Ecosystem for CV/AI, async/await support, team familiarity |
| **Database** | SQLite | 3.x | Event storage, settings | Zero-config, sufficient for MVP scale, easy backup |
| **ORM** | SQLAlchemy | 2.0+ with async | Database access | Type-safe queries, migrations support, async operations |
| **Camera Library** | OpenCV | 4.8+ | Camera capture, motion | Industry standard, RTSP support, cross-platform |
| **Motion Detection** | OpenCV MOG2 | Built-in | F2 (Motion Detection) | Background subtraction, adaptive, proven algorithm |
| **AI Primary** | OpenAI GPT-4o-mini | Latest API | F3 (AI Descriptions) | Best cost/performance, reliable API, good descriptions |
| **AI Fallback** | Google Gemini Flash | Latest API | F3 (AI Descriptions) | Free tier available, good quality, automatic fallback |
| **AI Tertiary** | Anthropic Claude Haiku | Latest API | F3 (AI Descriptions) | Additional fallback option, excellent quality |
| **Authentication** | JWT + HTTP-only cookies | python-jose | F7 (Auth) | Stateless, secure, XSS protection |
| **Password Hashing** | bcrypt | via passlib | F7 (Auth) | Industry standard, secure, slow by design |
| **API Key Encryption** | Fernet (symmetric) | cryptography lib | F7.2 | Secure storage of AI API keys |
| **WebSocket** | FastAPI/Starlette | Built-in | F6.6 (Real-time) | Native support, no additional services needed |
| **Background Tasks** | FastAPI BackgroundTasks | Built-in | F3 (AI processing) | Simple async tasks, no external queue needed for MVP |
| **State Management** | React Context | Built-in | Frontend global state | Sufficient for MVP, no Redux complexity |
| **Icons** | lucide-react | Latest | All UI icons | Consistent, lightweight, good selection |
| **Date Formatting** | date-fns | Latest | All date displays | Lightweight, immutable, locale support |

---

## Technology Stack Details

### Core Technologies

**Frontend Stack:**
- **Framework:** Next.js 15.x (App Router, React Server Components)
- **Language:** TypeScript 5.x (strict mode enabled)
- **Styling:** Tailwind CSS 3.x + shadcn/ui components
- **HTTP Client:** Built-in `fetch` with Next.js extensions
- **WebSocket:** Native browser WebSocket API
- **Form Handling:** React Hook Form + Zod validation
- **State:** React Context for global state, Server Components for data fetching
- **Icons:** lucide-react
- **Date/Time:** date-fns
- **Build Tool:** Turbopack (default in Next.js 15)

**Backend Stack:**
- **Framework:** FastAPI 0.115+ (ASGI)
- **Language:** Python 3.11+
- **Server:** Uvicorn (included with fastapi[standard])
- **Database:** SQLite 3.x (file-based: `backend/data/app.db`)
- **ORM:** SQLAlchemy 2.0+ (async engine)
- **Migrations:** Alembic
- **Camera/CV:** opencv-python 4.8+
- **AI SDKs:** openai, google-generativeai, anthropic
- **Auth:** python-jose (JWT), passlib (bcrypt)
- **Encryption:** cryptography (Fernet)
- **HTTP Client:** httpx (async)
- **WebSocket:** Built into FastAPI/Starlette

**Development Tools:**
- **Linting:** ESLint (frontend), Ruff (backend)
- **Formatting:** Prettier (frontend), Black (backend)
- **Testing:** Jest + React Testing Library (frontend), pytest (backend)
- **API Docs:** Auto-generated by FastAPI (Swagger UI + ReDoc)

### Integration Points

**Frontend ↔ Backend:**
- **REST API:** HTTP calls to `http://localhost:8000/api/v1/*`
- **WebSocket:** Persistent connection to `ws://localhost:8000/ws`
- **CORS:** Backend configured to allow frontend origin
- **Proxy:** Next.js API routes can proxy to backend (optional, for production)

**Backend ↔ Camera:**
- **Protocol:** RTSP for IP cameras, DirectShow/V4L2 for USB
- **Library:** OpenCV VideoCapture
- **Threading:** Separate thread per camera for frame capture
- **Frame Rate:** Configurable (default 5 FPS) to balance performance

**Backend ↔ AI Services:**
- **Protocol:** HTTPS REST APIs
- **Models:** OpenAI, Google Gemini, Anthropic Claude
- **Fallback:** Automatic retry with next provider if primary fails
- **Rate Limiting:** Respect free-tier limits, queue if necessary

**Backend ↔ Database:**
- **Connection:** SQLAlchemy async engine
- **Pooling:** Default SQLite connection pool
- **Transactions:** Automatic per-request transaction handling
- **Migrations:** Alembic for schema versioning

**Backend ↔ Webhook Targets:**
- **Protocol:** HTTPS POST (HTTP allowed but warned)
- **Retry:** 3 attempts with exponential backoff (1s, 2s, 4s)
- **Timeout:** 5 seconds per attempt
- **Headers:** Custom headers supported for auth

---

---

[← Previous: Project Initialization](./02-project-initialization.md) | [Next: Project Structure →](./04-project-structure.md) | [Back to Index](./README.md)
